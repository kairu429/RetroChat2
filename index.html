<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>RetroChat</title>
<style>
body { 
  font-family: monospace; 
  margin:0; 
  height:100vh; 
  display:flex; 
  justify-content:center; 
  align-items:center; 
  background-color: black; 
  color: limegreen;
}
#chatroom { 
  display:flex; 
  flex-direction:column; 
  width:80vw; 
  max-width:600px; 
  height:80vh; 
}
#chat { 
  flex:1; 
  border:1px solid limegreen; 
  padding:5px; 
  overflow-y:auto; 
  margin-bottom:5px; 
}
input {
  padding:10px; 
  font-size:1em; 
  background:black; 
  color:limegreen; 
  border:1px solid limegreen;
}
input::placeholder {
  color: limegreen;
  opacity: 0.7;
}
button { 
  padding:10px 20px; 
  font-size:1em; 
  margin-left:5px; 
  background:black; 
  color:limegreen; 
  border:1px solid white; 
  cursor:pointer;
}
button:hover {
  background:#111;
}
.inputContainer { display:flex; margin-bottom:10px; }
</style>
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js"></script>
</head>
<body>

<!-- チャット画面 -->
<div id="chatroom">
  <div id="chat"></div>

  <!-- メッセージ入力欄 -->
  <div class="inputContainer">
    <input id="msgInput" placeholder="メッセージを入力" />
    <button id="sendBtn">送信</button>
  </div>

  <!-- 名前入力欄 -->
  <div class="inputContainer">
    <input id="usernameInput" placeholder="名前を入力" />
    <button id="setNameBtn">OK</button>
  </div>
</div>

<script>
document.addEventListener("DOMContentLoaded", () => {
  const supabaseUrl = "https://zwxtdpvxozlsvvqktmxk.supabase.co";
  const supabaseKey = "（ここは省略）"; // ← 実際のキーを入れる
  const supabase = supabase.createClient(supabaseUrl, supabaseKey);

  const chatDiv = document.getElementById("chat");
  const sendBtn = document.getElementById("sendBtn");
  const setNameBtn = document.getElementById("setNameBtn");

  let username = "匿名"; // デフォルト名

  // 名前設定
  setNameBtn.addEventListener("click", () => {
    const inputName = document.getElementById("usernameInput").value.trim();
    if (inputName) {
      username = inputName;
      alert(`名前が「${username}」に設定されました`);
    } else {
      alert("名前を入力してください");
    }
  });

  // メッセージ送信
  function sendMessage() {
    const msgInput = document.getElementById("msgInput");
    if (msgInput.value.trim()) {
      supabase.from('Chat').insert([{ username, content: msgInput.value }]);
      msgInput.value = "";
    }
  }

  sendBtn.addEventListener("click", sendMessage);

  // リアルタイム購読
  supabase
    .from('Chat')
    .on('INSERT', payload => {
      const p = document.createElement('p');
      p.textContent = `[${payload.new.username}] ${payload.new.content}`;
      chatDiv.appendChild(p);
      chatDiv.scrollTop = chatDiv.scrollHeight;
    })
    .subscribe();
});
</script>

</body>
</html>
